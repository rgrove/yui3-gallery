YUI.add("gallery-overlay-modal",function(B){var K,A="overlayModal",H="overlay",F="modal",J="mask",I="host",G="boundingBox",E="Change",D=B.ClassNameManager.getClassName,C=B.Lang.isBoolean;K=function(L){K.superclass.constructor.apply(this,arguments);};B.mix(K,{NAME:A,NS:F,ATTRS:{mask:{value:true,validator:C}},CLASSES:{modal:D(H,F),mask:D(H,J)}});B.extend(K,B.Plugin.Base,{_maskNode:null,_focusHandle:null,initializer:function(L){this.doAfter("renderUI",this.renderUI);this.doAfter("bindUI",this.bindUI);this.doAfter("syncUI",this.syncUI);if(this.get(I).get("rendered")){this.renderUI();this.bindUI();this.syncUI();}},destructor:function(){if(this._maskNode){this._maskNode.remove(true);}this._detachFocusHandle();this.get(I).get(G).removeClass(K.CLASSES.modal);},renderUI:function(){this._maskNode=B.Node.create("<div></div>");this._maskNode.addClass(K.CLASSES.mask);this._maskNode.setStyles({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",zIndex:"-1"});this.get(I).get(G).addClass(K.CLASSES.modal);},bindUI:function(){this.after(J+E,this._afterMaskChange);this.get(I).after("visibleChange",B.bind(this._afterHostVisibleChange,this));},syncUI:function(){var L=this.get(I);this._uiSetMask(this.get(J));if(L.get("visible")===true){this._attachFocusHandle();L.get(G).focus();}else{this._detachFocusHandle();}},mask:function(){this.set(J,true);},unmask:function(){this.set(J,false);},_uiSetMask:function(L){var M=this.get(I).get(G);if(L){M.append(this._maskNode);}else{if(this._maskNode.get("parentNode")===M){this._maskNode.remove();}}},_attachFocusHandle:function(){this._focusHandle=B.one("document").on("focus",B.bind(function(M){var L=this.get(I).get(G);if(!L.contains(M.target)){L.focus();}},this));},_detachFocusHandle:function(){if(this._focusHandle){this._focusHandle.detach();}},_afterMaskChange:function(L){this._uiSetMask(L.newVal);},_afterHostVisibleChange:function(L){if(L.newVal===true){this._attachFocusHandle();this.get(I).get(G).focus();}else{this._detachFocusHandle();}}});B.namespace("Plugin").OverlayModal=K;},"gallery-2009.12.08-22",{requires:["overlay","plugin","event-focus"]});