YUI.add("gallery-xarno-calendar",function(d){var b="select",a="update",c="date";d.namespace("Xarno").Calendar=d.Base.create("xarno-calendar",d.Widget,[d.WidgetStdMod],{_cal:null,initializer:function(e){this.publish(a,{defaultFn:this._defUpdateFn});this.publish(b,{defaultFn:this._defSelectFn});},renderUI:function(){this._cal=d.Node.create(this.get("calendarTemplate"));this._buildDaysOfTheWeek();this._buildDays();},bindUI:function(){this.after("dateChange",function(f){this.fire(a);},this);this._cal.delegate("click",function(f){this.fire(b,{click:f});},".liner",this);},syncUI:function(){this.setStdModContent("body",this._cal,"after");},prevMonth:function(){var e=this.get(c);e.setMonth(e.getMonth()-1);this.set(c,e);return this;},nextMonth:function(){var e=this.get(c);e.setMonth(e.getMonth()+1);this.set(c,e);return this;},prevYear:function(){var e=this.get(c);e.setFullYear(e.getFullYear()-1);this.set(c,e);return this;},nextYear:function(){var e=this.get(c);e.setFullYear(e.getFullYear()+1);this.set(c,e);return this;},_dateValueFn:function(e){return new Date();},_weekStartSetter:function(e){return(e)?1:0;},_defUpdateFn:function(n){var p=new Date(this.get(c)),h=new Date(p),r=new Date(p),k=this.get("dateSelected"),g=this._cal,m,j,s=this.get("weekStart"),o=[],q=d.Node.create("<b />"),f=28+s;q.set("className",g.get("className"));p.setMonth(p.getMonth()+1);p.setDate(0);o=["d29","d30","d31"].splice(0,p.getDate()-28);q.replaceClass("d[0-9]+",o.join(" "));f+=o.length;p.setDate(0);o=[];if(p.getDate()-(p.getDate()-p.getDay()+s)<7){for(m=p.getDate()-p.getDay()+s,j=p.getDate();m<=j;m++){o.push("p"+m);}f+=o.length;}q.replaceClass("p[0-9]+",o.join(" "));o=[];for(m=1,j=42-(f-s);m<=j;m++){o.push("n"+m);}q.replaceClass("n[0-9]+",o.join(" "));g.set("className",q.get("className"));if(k){h.setDate(1);r.setMonth(r.getMonth()+1);r.setDate(0);if(h<=k&&r>=k){this._cal.one(".day-"+k.getDate()).addClass("selected");return;}}this._cal.all(".selected").removeClass("selected");},_defSelectFn:function(g){g=g.click;var h=new Date(this.get(c)),f=g.currentTarget.ancestor();this._cal.all(".selected").removeClass("selected");if(f.hasClass("previous")){h.setMonth(h.getMonth()-1);h.setDate(g.currentTarget.get("text"));this.set("dateSelected",h);this.prevMonth();return;}else{if(f.hasClass("next")){h.setMonth(h.getMonth()+1);h.setDate(g.currentTarget.get("text"));this.set("dateSelected",h);this.nextMonth();return;}}f.addClass("selected");h.setDate(g.currentTarget.get("text"));this.set("dateSelected",h);},_buildDaysOfTheWeek:function(){var j=this.get("daysOfTheWeek"),f=this.get("weekStart"),h="",g,e;if(f>0){j.push(j.splice(0,f));}h='<ul class="day-list">';for(g=0,e=j.length;g<e;g++){h+='<li class="day-name"><span class="liner">'+j[g]+"</span></li>";}h+="</ul>";this.setStdModContent("body",h);},_buildDays:function(){var k="",f,e,h=this.get("dayTemplate"),g=this.get("previousDayTemplate"),j=this.get("nextDayTemplate");for(f=22,e=31;f<=e;f++){k+=d.substitute(g,{count:f});}for(f=1,e=31;f<=e;f++){k+=d.substitute(h,{count:f});}for(f=1,e=14;f<=e;f++){k+=d.substitute(j,{count:f});}this._cal.setContent(k);this.fire(a);}},{ATTRS:{date:{valueFn:"_dateValueFn"},dateSelected:{value:null},daysOfTheWeek:{value:["Su","Mo","Tu","We","Th","Fr","Sa"]},weekStart:{value:0,setter:"_weekStartSetter"},calendarTemplate:{value:"<ul />"},dayTemplate:{value:'<li class="day day-{count}"><a class="liner">{count}</a></li>'},previousDayTemplate:{value:'<li class="day previous previous-day-{count}"><span class="liner">{count}</span></li>'},nextDayTemplate:{value:'<li class="day next next-day-{count}"><span class="liner">{count}</span></li>'}}});},"gallery-2010.12.10-17-31",{requires:["base-build","widget","widget-stdmod","substitute"]});